<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>
      Raphaelle test
    </title>
    <script src="jquery.js" type="text/javascript"></script>
    <script src="raphael.js" type="text/javascript"></script>
    <script src="raphaelle.js" type="text/javascript"></script>

    <style type="text/css" rel="stylesheet" media="screen">

    #frame {
      position: absolute;
      overflow: auto;
      /* top: 10px; left: 10px; right: 10px; bottom: 30px; */
      /* top: 0px; left: 0px; right: 0px; bottom: 30px; */
      top: 150px; left: 50px; right: 10px; bottom: 30px;
      border: 1px solid #0F0;
    }

    #content {
      position: absolute;
      overflow: auto;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }
    </style>
  </head>

  <body>
    <div id="frame">
      <div id="content"></div>
    </div>
    <script type="text/javascript">

      $(document).ready(function() {
	paper = Raphael('content', "100%", "100%");
	paper.canvas.raphael = paper; // .raphael is set for elements but not for the canvas
	paper.name = "paper";

	var moveable = paper.rect(300, 300, 40, 20, 10);
	moveable.name = "moveable";
	moveable.attr({fill: "#000", "fill-opacity": 0, stroke: "#009", "stroke-width": 3});
	moveable.draggable();
	moveable.dragStart = function(x, y, e) {
	  // console.log("dragging "+this.name+" from "+x+", "+y);
	  this.toFront();
	}

	var resizable = paper.rect(5, 20, 100, 40, 10);
	resizable.attr({fill: "#EEF", stroke: "#009", "stroke-width": 3});
	resizable.name = "resizable";
	resizable.draggable({reluctance: 20});	// Be reluctant to start resizing
	resizable.dragStart = function() { this.toFront(); }

	// Resize the rectangle down to a minimum size.
	resizable.dragUpdate = function(draggingOver, dx, dy, event) {
	  // console.log("dragUpdate(draggingOver="+draggingOver.raphael.name+", dx="+dx+", dy="+dy+", e)");
	  var new_width = resizable.attrs.width + dx;
	  var new_height = resizable.attrs.height + dy;
	  if (new_height < 20)
	    new_height = 20;
	  if (new_width < 20)
	    new_width = 20;
	  // resizable.attr({width: new_width, height: new_height });
	  var o = $('#content').offset();
	  this.attr({width: event.pageX-o.left-this.attr('x'), height: event.pageY-o.top-this.attr('y') });
	  //this.translate(dx, dy);
	};

	resizable.dragFinish = function(droppedOn, x, y, event) {
	  // console.log("Dropped on "+droppedOn.raphael.name+" at "+x+", "+y);
	  //alert("Done, unbind");
	};
      });

    </script>
  </body>
</html>
